@using TailwindMerge
@inherits LayoutComponentBase

@inject TwMerge Merge

@if (AsChild)
{
    <CascadingValue IsFixed="true" Name="InheritedAttributes" Value="@Attributes" TValue="Dictionary<string, object>">
        @Body
    </CascadingValue>
}
else
{
    @if (InheritedAttributes != null)
    {
        <CascadingValue IsFixed="true" Name="InheritedAttributes" Value="null" TValue="Dictionary<string, object>">
            @Body
        </CascadingValue>
    }
    else
    {
        @Body
    }
}

@code
{
    [CascadingParameter(Name = "InheritedAttributes")]
    public Dictionary<string, object?>? InheritedAttributes { get; set; }
    
    [Parameter] public bool AsChild { get; set; } = false;
    
    [Parameter] public string ClassName { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? Props { get; set; }

    protected Dictionary<string, object?> Attributes;

    public string? Cn(params string?[] classes)
        => Merge.Merge(classes);

    protected override void OnParametersSet()
    {
        Attributes = CollectAttributes();
    }

    protected virtual void GetAttributes(Dictionary<string, object?> attributes)
    {
        
    }

    private Dictionary<string, object?> CollectAttributes()
    {
        var attributes = new Dictionary<string, object?>();

        if (InheritedAttributes != null)
        {
            foreach (var attribute in InheritedAttributes)
                attributes[attribute.Key] = attribute.Value;
        }

        GetAttributes(attributes);

        if (Props == null)
            return attributes;

        foreach (var prop in Props)
            attributes[prop.Key] = prop.Value;
        
        return attributes;
    }
}
