@inherits ShadcnBase

@if (AsChild)
{
    @ChildContent.Invoke(Attributes)
}
else
{
    <button type="button" @attributes="Attributes">
        @ChildContent.Invoke(null!)
    </button>
}

@code
{
    [Parameter] public RenderFragment<Dictionary<string, object?>> ChildContent { get; set; }
    [Parameter] public bool AsChild { get; set; } = false;
    [CascadingParameter] public Dialog Parent { get; set; }

    private Dictionary<string, object?> Attributes;

    protected override void OnParametersSet()
    {
        Attributes = new();

        Attributes["aria-haspopup"] = "dialog";
        Attributes["aria-expanded"] = Parent.IsOpen.ToString().ToLower();
        Attributes["data-state"] = Parent.IsOpen.ToString().ToLower();
        Attributes["onclick"] = EventCallback.Factory.Create(this, HandleClickAsync);
        
        if(Props == null)
            return;

        foreach (var prop in Props)
            Attributes[prop.Key] = prop.Value;
    }

    private async Task HandleClickAsync()
    {
        await Parent.OpenAsync();
    }
}
