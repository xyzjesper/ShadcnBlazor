@inherits ShadcnBase

<button data-slot="toggle"
        class="@Classes"
        data-state="@(Pressed ? "on" : "off")"
        disabled="@Disabled"
        data-disabled="@Disabled"
        @onclick="ToggleAsync"
        @attributes="Props">
    @ChildContent
</button>

@code
{
    [Parameter] public RenderFragment ChildContent { get; set; }
    [Parameter] public ToggleVariant Variant { get; set; } = ToggleVariant.Default;
    [Parameter] public ToggleSize Size { get; set; } = ToggleSize.Default;
    [Parameter] public EventCallback<bool> OnPressedChange { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public bool DefaultPressed { get; set; }

    private string? Classes;
    private bool Pressed;

    protected override void OnInitialized()
    {
        Pressed = DefaultPressed;
    }

    protected override void OnParametersSet()
    {
        Classes = Cn(
            "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",
            "hover:cursor-pointer",
            GetSizeClasses(),
            GetVariantClasses(),
            ClassName
        );
    }

    private async Task ToggleAsync()
    {
        if(Disabled)
            return;
        
        Pressed = !Pressed;
        await InvokeAsync(StateHasChanged);

        await OnPressedChange.InvokeAsync(Pressed);
    }

    private string GetSizeClasses()
    {
        return Variant switch
        {
            ToggleVariant.Default => "bg-transparent",
            ToggleVariant.Outline => "border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground",
            _ => throw new ArgumentOutOfRangeException()
        };
    }

    private string GetVariantClasses()
    {
        return Size switch
        {
            ToggleSize.Default => "h-9 px-2 min-w-9",
            ToggleSize.Sm => "h-8 px-1.5 min-w-8",
            ToggleSize.Lg => "h-10 px-2.5 min-w-10",
            _ => throw new ArgumentOutOfRangeException()
        };
    }
}
