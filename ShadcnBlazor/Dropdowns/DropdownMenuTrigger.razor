@using ShadcnBlazor.Buttons
@using ShadcnBlazor.Menu

@if (Slot != null)
{
    <div @ref="Context.TriggerElement">
        @Slot.Invoke(Attributes)
    </div>
}
else
{
    <Button>
        <Slot>
            <button @ref="Context.TriggerElement" type="button" @attributes="context.Concat(Attributes)">
                @ChildContent
            </button>
        </Slot>
    </Button>
}

@code
{
    [CascadingParameter(Name = "Menu")] public Menu Menu { get; set; }
    [CascadingParameter(Name = "DropdownMenu")] public DropdownMenu Context { get; set; }
    [Parameter] public RenderFragment ChildContent { get; set; }
    [Parameter] public RenderFragment<Dictionary<string, object?>>? Slot { get; set; }

    private Dictionary<string, object?> Attributes;

    protected override void OnParametersSet()
    {
        Attributes = new();

        Attributes["onclick"] = EventCallback.Factory.Create(this, OpenDropdownAsync);
    }

    private async Task OpenDropdownAsync()
    {
        await Menu.OpenAsync();
    }
}