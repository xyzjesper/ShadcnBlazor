@using ShadcnBlazor.Menu

@inherits ShadcnBase

@implements IMenuItem

<div>

</div>

@code
{
    [CascadingParameter(Name = "MenuParent")]
    public IMenuParent Parent { get; set; }

    [Parameter] public RenderFragment ChildContent { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public EventCallback OnClick { get; set; }
    [Parameter] public bool Inset { get; set; }
    [Parameter] public MenubarItemVariant Variant { get; set; } = MenubarItemVariant.Default;

    private string? Classes;
    private Dictionary<string, object?> Attributes;

    protected override void OnParametersSet()
    {
        Attributes = new();

        Attributes["data-slot"] = "menubar-item";
        Attributes["data-inset"] = Inset;
        Attributes["data-disabled"] = Disabled;
        Attributes["disabled"] = Disabled;
        Attributes["data-variant"] = Variant.ToString().ToLowerInvariant();

        Attributes["class"] = Cn(
            "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4", "hover:cursor-pointer",
            Classes
        );
        
        Attributes["tabindex"] = "-1";
        Attributes["data-orientation"] = "vertical";
        Attributes["onclick"] = EventCallback.Factory.Create(this, OnClickAsync);
        Attributes["onfocusin"] = EventCallback.Factory.Create(this, OnFocusInAsync);
        Attributes["onmouseover"] = "this.focus()";

        if(Props == null)
            return;

        foreach (var prop in Props)
            Attributes[prop.Key] = prop.Value;
    }

    public Task OnUnfocusedAsync()
        => Task.CompletedTask;

    private async Task OnClickAsync()
    {
        if (Disabled)
            return;

        await Parent.CloseMenuAsync();
        await OnClick.InvokeAsync();
    }

    private async Task OnFocusInAsync()
        => await Parent.ChangeFocusAsync(this);
}
