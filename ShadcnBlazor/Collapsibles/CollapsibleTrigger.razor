@if (Slot != null)
{
    @Slot.Invoke(Attributes)
}
else
{
    <span @attributes="Attributes">
        @ChildContent
    </span>
}

@code
{
    [CascadingParameter] public Collapsible Collapsible { get; set; }
    
    [Parameter] public RenderFragment ChildContent { get; set; }
    [Parameter] public RenderFragment<Dictionary<string, object?>>? Slot { get; set; }

    private Dictionary<string, object?> Attributes;

    protected override void OnParametersSet()
    {
        Attributes = new();

        Attributes["data-state"] = Collapsible.IsOpen ? "open" : "closed";
        Attributes["data-disabled"] = Collapsible.Disabled;
        Attributes["onclick"] = EventCallback.Factory.Create(this, OnClickAsync);
    }

    private async Task OnClickAsync()
    {
        if(Collapsible.Disabled)
            return;
        
        await Collapsible.ToggleAsync();
    }
}
